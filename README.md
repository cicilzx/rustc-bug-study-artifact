# Overview

This is the artifact for the OOPSLA'25 paper titled "An Empirical Study of Rust-Specific Bugs in the rustc Compiler".

## Directory Structure


### Project Structure

* **`data_collection` folder**: A Python project for automatically crawling GitHub issues.
* **`plot` folder**: Contains all scripts for data visualization.
* **`scripts` folder**: Contains all scripts used to reproduce the results in our study.
* **`Test_Case_Characteristics` folder**: A Rust project for extracting ASTs and collecting node-level statistics to analyze test case features.
* **`test_cases` folder**: Stores all collected bug-revealing test cases.

* **`Data Files` folder**:
  
  * **`all_issues.csv`**: Contains all collected and labeled GitHub issues.  
  * **`item_node_counts.csv`**: Contains statistics of `Item` nodes in ASTs. This file can be generated by running the `Test_Case_Characteristics` project.  
  * **`type_node_counts.csv`**: Contains statistics of `Type` nodes in ASTs. This file can also be generated by running the `Test_Case_Characteristics` project.

### Figures

* **`Fig4a.pdf`**, **`Fig4b.pdf`**, **`Fig10a.pdf`**, and **`Fig10b.pdf`**: These are the visualizations corresponding to Figures 4(a), 4(b), 10(a), and 10(b) in our paper. They can be plotted using the scripts in the `plot` folder.



## Requirements

There are two ways to run this project: using Docker or running it directly on a local machine.

### Option 1: Using Docker (Recommended)

A pre-configured Docker environment can simplify setup and ensure compatibility across systems. You can use the provided `Dockerfile` to build the environment with all necessary dependencies.

To build the Docker image named `rustc-bug-study` from source, run the following command (estimated running time: ~5 min)
```bash
docker build -t rustc-bug-study .
```

Run the following command to create a new container.
```bash
docker run -it --rm \
  -v $(pwd)/data_collection:/app/data_collection \
  -v $(pwd)/plot:/app/plot \
  -v $(pwd)/scripts:/app/scripts \
  -v $(pwd)/Test_Case_Characteristics:/app/Test_Case_Characteristics \
  -v $(pwd)/test_cases:/app/test_cases \
  -v $(pwd)/data:/app/data \
  -w /app \
  rustc-bug-study
```


### Option 2: Run Locally

To run the project locally, your system should meet the following requirements:

* **Operating System**: A Unix-like operating system
  *(tested on Ubuntu)*
* **Rust**: Installed and properly configured
  *(tested on Rust 1.87)*
* **Python**: Version 3.12 or higher
  *(tested on Python 3.12)*

Make sure `cargo` and `python3` are available in your environment. You may also need to install Python packages listed in `requirements.txt` by running:

```bash
pip install -r requirements.txt
```



# Step-by-Step Instructions

In the following section, we provide instructions for reproducing the results presented in the paper.

## Collecting Bugs & Fixes (Section 2)

To reproduce Table 1, please run the following script to print statistics of our collect labels.
```bash
python3 ./scripts/labels.py
```

To reproduce Table 2, please run the following script to print statistics related to our bug collection phases.

```bash
python3 ./scripts/status.py
```

The above script prints the following:
```
Status                 Count
------------------------------
Duplicate                 88
Not a bug                 28
Not reproducible          56
Discussion                 6
Exclude                   92
Valid                    301
------------------------------
Total                    571
```

### Optional Step: Crawling GitHub Issues

**Running the crawler is not required for the subsequent steps.** Crawling can be time-consuming, and the collected data only contains raw GitHub issue information, without our annotations for bug causes, symptoms, etc.

To ensure consistency, we have already provided the annotated CSV files in this artifact. You can directly proceed to the reproduction steps using the provided `./data/all_issues.csv` file.

If you still want to crawl the issues yourself, please run the following scripts.

**Note**: Please replace `<token>` with your [GitHub authentication token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens).
```bash
cd data_collection
python3 main.py issue ./all_issues.csv <token>
```

The generated `all_issues.csv` file would be stored in `./rustc-bug-study-artifact/data_collection/all_issues.csv`.

## RQ1: Bug Causes (Section 3)

In the first research question, we compute the distribution of bug causes. Specifically, the script reproduces Table 3.
```bash
python3 ./scripts/rq1_causes.py
```

The above script prints the following:
```
Bug Cause                        Count     Ratio
--------------------------------------------------
Trait & Bound                       37    12.29%
Opaque types                        38    12.62%
New solver                           7     2.33%
Well-formedness                      9     2.99%
Subtotal                            91    30.23%
--------------------------------------------------
Borrow & Move                        7     2.33%
Lifetime                            34    11.30%
Subtotal                            41    13.62%
--------------------------------------------------
Wrong implementations               34    11.30%
Missing cases                       12     3.99%
Subtotal                            46    15.28%
--------------------------------------------------
Basic structure                     38    12.62%
Error handling & Reporting          75    24.92%
Compatibility                       10     3.32%
Subtotal                           123    40.86%
--------------------------------------------------
Total                              301   100.00%
```

As for the bug prone compilation stages, please run the following script to reproduce Fig. 4 (a):

```bash
python3 ./scripts/rq1_components_a.py
```

The above script prints the following:
```
Stage                                Cause       Ratio
--------------------------------------------------------
1. AST                  Type System Errors       0.33%
1. AST         Ownership & Lifetime Errors       3.65%
1. AST             MIR Optimization Errors       0.00%
1. AST                      General Errors       3.99%
Subtotal                                24       7.97%
--------------------------------------------------------
2. HIR                  Type System Errors      20.27%
2. HIR         Ownership & Lifetime Errors       4.98%
2. HIR             MIR Optimization Errors       0.00%
2. HIR                      General Errors      19.60%
Subtotal                               135      44.85%
--------------------------------------------------------
3. MIR                  Type System Errors       6.31%
3. MIR         Ownership & Lifetime Errors       4.98%
3. MIR             MIR Optimization Errors      15.28%
3. MIR                      General Errors       8.64%
Subtotal                               106      35.22%
--------------------------------------------------------
4. Code Gen             Type System Errors       0.00%
4. Code Gen    Ownership & Lifetime Errors       0.00%
4. Code Gen        MIR Optimization Errors       0.00%
4. Code Gen                 General Errors       1.66%
Subtotal                                 5       1.66%
--------------------------------------------------------
5. Utility              Type System Errors       3.32%
5. Utility     Ownership & Lifetime Errors       0.00%
5. Utility         MIR Optimization Errors       0.00%
5. Utility                  General Errors       4.65%
Subtotal                                24       7.97%
--------------------------------------------------------
6. LLVM                 Type System Errors       0.00%
6. LLVM        Ownership & Lifetime Errors       0.00%
6. LLVM            MIR Optimization Errors       0.00%
6. LLVM                     General Errors       2.33%
Subtotal                                 7       2.33%
--------------------------------------------------------
Total                                  301     100.00%
```

similarly, please run the following script to reproduce Fig. 4 (b):
```bash
python3 ./scripts/rq1_components_b.py
```

The above script prints the following:
```
Stage                                             Cause       Ratio
---------------------------------------------------------------------
2. HIR-type & wf check               Type System Errors      25.19%
2. HIR-type & wf check      Ownership & Lifetime Errors       2.96%
2. HIR-type & wf check          MIR Optimization Errors       0.00%
2. HIR-type & wf check                   General Errors      22.96%
Subtotal                                             69      51.11%
---------------------------------------------------------------------
2. HIR-trait solving                 Type System Errors      17.78%
2. HIR-trait solving        Ownership & Lifetime Errors       1.48%
2. HIR-trait solving            MIR Optimization Errors       0.00%
2. HIR-trait solving                     General Errors       8.15%
Subtotal                                             37      27.41%
---------------------------------------------------------------------
2. HIR-Type Infer                    Type System Errors       1.48%
2. HIR-Type Infer           Ownership & Lifetime Errors       4.44%
2. HIR-Type Infer               MIR Optimization Errors       0.00%
2. HIR-Type Infer                        General Errors       1.48%
Subtotal                                             10       7.41%
---------------------------------------------------------------------
2. HIR-report                        Type System Errors       0.74%
2. HIR-report               Ownership & Lifetime Errors       2.22%
2. HIR-report                   MIR Optimization Errors       0.00%
2. HIR-report                            General Errors      11.11%
Subtotal                                             19      14.07%
---------------------------------------------------------------------
3. MIR-MIR Transform                 Type System Errors       1.89%
3. MIR-MIR Transform        Ownership & Lifetime Errors       4.72%
3. MIR-MIR Transform            MIR Optimization Errors      42.45%
3. MIR-MIR Transform                     General Errors       0.94%
Subtotal                                             53      50.00%
---------------------------------------------------------------------
3. MIR-Borrow Check                  Type System Errors      16.04%
3. MIR-Borrow Check         Ownership & Lifetime Errors       4.72%
3. MIR-Borrow Check             MIR Optimization Errors       0.94%
3. MIR-Borrow Check                      General Errors       3.77%
Subtotal                                             27      25.47%
---------------------------------------------------------------------
3. MIR-Dataflow Analysis             Type System Errors       0.00%
3. MIR-Dataflow Analysis    Ownership & Lifetime Errors       0.00%
3. MIR-Dataflow Analysis        MIR Optimization Errors       0.00%
3. MIR-Dataflow Analysis                 General Errors       8.49%
Subtotal                                              9       8.49%
---------------------------------------------------------------------
3. MIR-report                        Type System Errors       0.00%
3. MIR-report               Ownership & Lifetime Errors       4.72%
3. MIR-report                   MIR Optimization Errors       0.00%
3. MIR-report                            General Errors      11.32%
Subtotal                                             17      16.04%
---------------------------------------------------------------------
```

### Data Visualization (Optional)
Optionally, the following script can plot Fig. 4 (a) and Fig. 4 (b) and save them as `./plot/Fig4a.pdf` and `./plot/Fig4b.pdf`.
```bash
python3 ./plot/fig4a.py
python3 ./plot/fig4b.py
```
If you are using the Docker container, the files `Fig4a.pdf` and `Fig4b.pdf` will be generated inside the container and can be directly accessed from your host machine in the `./rustc-bug-study-artifact/plot/` directory.


## RQ2: Bug Symptoms (Section 4)
In the second research question, we compute the distribution of bug symptoms. Specifically, the following two script reproduces Table 4.

```bash
python3 ./scripts/rq2_a.py
```
This script reproduces Table 4 by presenting the detailed breakdown of bug symptoms. It categorizes and counts each sub-type of symptom observed in the dataset.
It prints the following:

```
Symptom                                                   Count       Ratio
-----------------------------------------------------------------------------
1. Crash-Front-end Panic(valid)                              42      13.95%
1. Crash-Front-end Panic(invalid)                            75      24.92%
1. Crash-Back-end Crash                                       3       1.00%
Subtotal                                                    120      39.87%
-----------------------------------------------------------------------------
2. Correctness Issues-Completeness Issues                    56      18.60%
2. Correctness Issues-Soundness Issues                       22       7.31%
Subtotal                                                     78      25.91%
-----------------------------------------------------------------------------
3. Miscompilation-Inconsistent Output Issues                 18       5.98%
3. Miscompilation-Safe Rust Causes UB                        12       3.99%
Subtotal                                                     30       9.97%
-----------------------------------------------------------------------------
4. Diagnostic Issues-Incorrect Warning/Error                 20       6.64%
4. Diagnostic Issues-Improper Fix Suggestion                 38      12.62%
Subtotal                                                     58      19.27%
-----------------------------------------------------------------------------
5. Misoptimization                                           15       4.98%
Subtotal                                                     15       4.98%
-----------------------------------------------------------------------------
Total                                                       301     100.00%
```


The following script also reproduces Table 4, but focuses on showing the joint distribution and proportions of bug symptoms and their corresponding causes, providing a cross-tabulation of these two dimensions.

```bash
python3 ./scripts/rq2_b.py
```

It prints the following:
```
Symptom GroupCause                              Count       Ratio
----------------------------------------------------------------
1.        Type System Errors                    30      25.00%
1.        Ownership & Lifetime Errors            3       2.50%
1.        MIR Optimization Errors               19      15.83%
1.        General Errors                        68      56.67%
Subtotal                                       120     100.00%
----------------------------------------------------------------
2.        Type System Errors                    43      55.13%
2.        Ownership & Lifetime Errors           17      21.79%
2.        MIR Optimization Errors                7       8.97%
2.        General Errors                        11      14.10%
Subtotal                                        78     100.00%
----------------------------------------------------------------
3.        Type System Errors                     5      16.67%
3.        Ownership & Lifetime Errors            4      13.33%
3.        MIR Optimization Errors               12      40.00%
3.        General Errors                         9      30.00%
Subtotal                                        30     100.00%
----------------------------------------------------------------
4.        Type System Errors                    12      20.69%
4.        Ownership & Lifetime Errors           16      27.59%
4.        MIR Optimization Errors                1       1.72%
4.        General Errors                        29      50.00%
Subtotal                                        58     100.00%
----------------------------------------------------------------
5.        Type System Errors                     1       6.67%
5.        Ownership & Lifetime Errors            1       6.67%
5.        MIR Optimization Errors                7      46.67%
5.        General Errors                         6      40.00%
Subtotal                                        15     100.00%
----------------------------------------------------------------
```



## RQ3: Test Case Characteristics (Section 5)

In the third research question, we analyz the test case characteristics.

To reproduce Table 5, please run the following script to get the LOC information:

```bash
python3 ./scripts/rq3_loc.py
```

It prints the following:
```
Test case (original)             Value
--------------------------------------
Mean                             17.83
Median                           12.00
Second smallest non-zero             2
Max                                346

Test case (reduced)              Value
--------------------------------------
Mean                             14.18
Median                           11.00
Second smallest non-zero             2
Max                                123
```

To reproduce Table 6, please run the following script to get the information of `Item` node:
```bash
python3 ./scripts/rq3_ast_item.py
```

It prints the following:
```
Node Type            Total   Prevalence    Average        Max
Function               524      100.00%       1.93          8
Struct                 130       37.64%       1.27          4
Impl                   157       37.64%       1.54          6
Trait                  144       34.32%       1.55          6
Use                     64       20.30%       1.16          3
Type                    29        7.38%       1.45          6
Enum                     8        2.95%       1.00          1
Macro                   11        2.95%       1.38          2
ExternCrate              7        2.58%       1.00          1
Static                   7        2.21%       1.17          2
Mod                      8        1.85%       1.60          3
Const                    5        1.85%       1.00          1
Verbatim                 4        1.11%       1.33          2
ForeignMod               2        0.74%       1.00          1
TraitAlias               1        0.37%       1.00          1
Union                    0        0.00%       0.00          0
Other                    0        0.00%       0.00          0
```

To reproduce Table 6, please run the following script to get the information of `Type` node:
```bash
python3 ./scripts/rq3_ast_type.py
```
It prints the following:
```
Node Type            Total   Prevalence    Average        Max
Path                  1262       88.19%       5.28         41
Reference              276       43.91%       2.32         10
Tuple                  161       30.26%       1.96          8
ImplTrait               87       20.66%       1.55         10
Array                   55       11.44%       1.77         10
TraitObject             49       10.70%       1.69          3
Ptr                     35        7.75%       1.67          4
Infer                   18        4.80%       1.38          2
BareFn                  21        4.06%       1.91          5
Slice                   13        2.95%       1.62          3
Never                    1        0.37%       1.00          1
Paren                    1        0.37%       1.00          1
Group                    0        0.00%       0.00          0
Macro                    0        0.00%       0.00          0
Verbatim                 0        0.00%       0.00          0
Other                    0        0.00%       0.00          0
```

To reproduce Table 7, please run the folllowing script to get all the information:
```bash
python3 ./scripts/rq3_features.py
```

### Parsing AST (Optional)
Optionally, if you want to parse the AST and get all the information, please run the Rust project in `Test_Case_Characteristics`. The script is as follows:
```bash
cd Test_Case_Characteristics
cargo run
```
Then, two files (`item_node_counts.csv` and `type_node_counts.csv`) will be saved in `./Test_Case_Characteristics` folder, which is same as `./item_node_counts.csv` and `./type_node_counts.csv`.

If you are using the Docker container, these files can be directly accessed from your host machine in the `./rustc-bug-study-artifact/Test_Case_Characteristics/` directory.



## RQ4: Status of Existing Techniques (Section 6)

In the last research question, we analyze the status of existing techniques. 

To reproduce Fig. 10(a), please run the following script to get the distribution of bug symptoms across existing tools:
```bash
python3 ./scripts/rq4_a.py
```
It prints the following:
```
Symptom Group               Found by          Count
---------------------------------------------------
1. Crash                    members              18
                            icemaker             56
                            developer            41
                            Rustlantis            1
                            fuzz-rustc            4
Subtotal                                        120
---------------------------------------------------
2. Correctness Issues       members              40
                            developer            38
Subtotal                                         78
---------------------------------------------------
3. Miscompilation           members               8
                            icemaker              1
                            developer            13
                            Rustlantis            8
Subtotal                                         30
---------------------------------------------------
4. Diagnostic Issues        members              14
                            icemaker              2
                            developer            42
Subtotal                                         58
---------------------------------------------------
5. Misoptimization          members               6
                            developer             9
Subtotal                                         15
---------------------------------------------------
```

To reproduce Fig. 10(b), please run the following script to get the distribution of bug causes across testing tools:
```bash
python3 ./scripts/rq4_b.py
```
It prints the following:
```
Cause Group                     Found by          Count
-------------------------------------------------------
Type System Errors              members              31
                                icemaker             11
                                developer            47
                                fuzz-rustc            2
Subtotal                                             91
-------------------------------------------------------
Ownership & Lifetime Errors     members              19
                                icemaker              1
                                developer            19
                                Rustlantis            1
                                fuzz-rustc            1
Subtotal                                             41
-------------------------------------------------------
MIR Optimization Errors         members              14
                                icemaker              8
                                developer            19
                                Rustlantis            5
Subtotal                                             46
-------------------------------------------------------
General Errors                  members              22
                                icemaker             39
                                developer            58
                                Rustlantis            3
                                fuzz-rustc            1
Subtotal                                            123
-------------------------------------------------------
```

### Data Visualization (Optional)
Optionally, the following script can plot Fig. 10 (a) and Fig. 10 (b) and save them as `./Fig10a.pdf` and `./Fig10b.pdf`.
```bash
python3 ./plot/fig10a.py
python3 ./plot/fig10b.py
```
If you are using the Docker container, the files `Fig10a.pdf` and `Fig10b.pdf` will be generated inside the container and can be directly accessed from your host machine in the `./rustc-bug-study-artifact/plot/` directory.